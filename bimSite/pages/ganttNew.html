<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>shanghai qihoubim</title>

    <!-- Bootstrap Core CSS -->
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="../vendor/metisMenu/metisMenu.min.css" rel="stylesheet">

    <!-- DataTables CSS -->
    <link href="../vendor/datatables-plugins/dataTables.bootstrap.css" rel="stylesheet">

    <!-- DataTables Responsive CSS -->
    <link href="../vendor/datatables-responsive/dataTables.responsive.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../dist/css/sb-admin-2.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


    <script src="../js/codebase/dhtmlxgantt.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/codebase/locale/locale_cn.js"></script>
    <link rel="stylesheet" href="../js/codebase/skins/dhtmlxgantt_meadow.css" type="text/css" media="screen" title="no title" charset="utf-8">

</head>

<style type="text/css">
    html, body {
        margin: 0px;
        padding: 0px;
        height: 100%;
        overflow: hidden;
    }

    .baseline {
        position: absolute;
        border-radius: 2px;
        opacity: 0.6;
        margin-top: -7px;
        height: 12px;
        background: #ffd180;
        border: 1px solid rgb(255, 153, 0);
    }

    /* move task lines upper */
    .gantt_task_line, .gantt_line_wrapper {
        margin-top: -9px;
    }

    .gantt_side_content {
        margin-bottom: 7px;
    }

    .gantt_task_link .gantt_link_arrow {
        margin-top: -10px;
    }

    .gantt_side_content.gantt_right {
        bottom: 0;
    }
</style>

<body>

    <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="main.html">QH BIM v1.0</a>
            </div>
            <!-- /.navbar-header -->

            <ul class="nav navbar-top-links navbar-right">
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-envelope fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-messages">
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>Read All Messages</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-messages -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-tasks fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-tasks">
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 1</strong>
                                        <span class="pull-right text-muted">40% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                            <span class="sr-only">40% Complete (success)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 2</strong>
                                        <span class="pull-right text-muted">20% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%">
                                            <span class="sr-only">20% Complete</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 3</strong>
                                        <span class="pull-right text-muted">60% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                            <span class="sr-only">60% Complete (warning)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 4</strong>
                                        <span class="pull-right text-muted">80% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                            <span class="sr-only">80% Complete (danger)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>See All Tasks</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-tasks -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-bell fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-alerts">
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-comment fa-fw"></i> New Comment
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                    <span class="pull-right text-muted small">12 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-envelope fa-fw"></i> Message Sent
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-tasks fa-fw"></i> New Task
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>See All Alerts</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-alerts -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="#"><i class="fa fa-user fa-fw"></i> User Profile</a>
                        </li>
                        <li><a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>
                        </li>
                        <li class="divider"></li>
                        <li id="li_loginout">
                            <a href="#"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
            <!-- /.navbar-top-links -->

            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <!-- 通过api获取modules -->
                        <li id="li_1">
                            <a href="tables.html"><i class="fa fa-apple fa-fw"></i> 质量管理<span class="fa arrow"></span></a>
                            <!-- subItems -->
                            <!-- 模型管理 -->
                            <!-- 嵌套外部view -->
                            <!-- 文档管理 -->
                            <!-- 文档上传， 文档下载 -->
                            <!-- 视频管理 -->
                            <!-- 视频上传， 视频下载 -->
                            <ul class="nav nav-second-level collapse">
                                <li>
                                    <a href="models.html?moduleID=1&pageID=3">模型管理</a>
                                </li>
                                <li>
                                    <a href="files.html?moduleID=1&pageID=1">文档管理</a>
                                </li>
                                <li>
                                    <a href="videos.html?moduleID=1&pageID=2">视频管理</a>
                                </li>
                            </ul>
                        </li>
                        <li id="li_2">
                            <a href="tables.html"><i class="fa fa-windows fa-fw"></i> 安全管理<span class="fa arrow"></span></a>
                            <!-- subItems -->
                            <!-- 模型管理 -->
                            <!-- 文档管理 -->
                            <!-- 视频管理 -->
                            <ul class="nav nav-second-level">
                                <li>
                                    <!--<a href="models.html?moduleID=2&pageID=30">施工场地设置区域划分</a>-->
                                    <a href="#">现场平面布置</a>
                                    <ul class="nav nav-third-level" aria-expanded="false">
                                        <li><a href="models.html?moduleID=2&pageID=30">场地布置模型</a></li>
                                        <li><a href="videos.html?moduleID=2&pageID=31">场地模拟动画</a></li>
                                        <li><a href="files.html?moduleID=2&pageID=42">场地布置建议</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <!--<a href="videos.html?moduleID=2&pageID=31">重大危险源施工过程仿真模拟</a>-->
                                    <a href="#">重大危险源管理</a>
                                    <ul class="nav nav-third-level collapse" aria-expanded="false">
                                        <li><a href="videos.html?moduleID=2&pageID=40">重大危险源模拟</a></li>
                                        <li><a href="files.html?moduleID=2&pageID=41">模拟检查报告</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <!--<a href="files.html?moduleID=2&pageID=32">安全管理人员责任体系</a>-->
                                    <a href="#">安全责任体系</a>
                                    <ul class="nav nav-third-level collapse" aria-expanded="false">
                                        <li><a href="files.html?moduleID=2&pageID=32">安全责任体系</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <!--<a href="files.html?moduleID=2&pageID=33">特种作业人员持证信息</a>-->
                                    <a href="#">特种人员信息</a>
                                    <ul class="nav nav-third-level collapse" aria-expanded="false">
                                        <li><a href="files.html?moduleID=2&pageID=33">特种人员信息</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <!--<a href="files.html?moduleID=2&pageID=34">安全技术措施</a>-->
                                    <a href="#">专项安全方案</a>
                                    <ul class="nav nav-third-level collapse" aria-expanded="false">
                                        <li><a href="files.html?moduleID=2&pageID=34">专项安全方案</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <!--<a href="files.html?moduleID=2&pageID=35">安全交底记录</a>-->
                                    <a href="#">安全交底记录</a>
                                </li>
                                <li>
                                    <!--<a href="files.html?moduleID=2&pageID=36">施工机械设备及安全设施的验收</a>-->
                                    <a href="#">设备设施验收</a>
                                    <ul class="nav nav-third-level collapse" aria-expanded="false">
                                        <li><a href="files.html?moduleID=2&pageID=35">设备设施验收</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <!--<a href="files.html?moduleID=2&pageID=37">施工控制监测</a>-->
                                    <a href="#">施工控制监测</a>
                                    <ul class="nav nav-third-level collapse" aria-expanded="false">
                                        <li><a href="models.html?moduleID=2&pageID=36">施工监测模型</a></li>
                                        <li><a href="files.html?moduleID=2&pageID=37">施工监测报告</a></li>
                                        <li><a href="#">施工监测报警</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <!--<a href="files.html?moduleID=2&pageID=38">安全日志</a>-->
                                    <a href="#">施工安全日志</a>
                                    <ul class="nav nav-third-level collapse" aria-expanded="false">
                                        <li><a href="files.html?moduleID=2&pageID=38">施工安全日志</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <!--<a href="files.html?moduleID=2&pageID=39">安全相关其他文件</a>-->
                                    <a href="#">其他安全文件</a>
                                    <ul class="nav nav-third-level collapse" aria-expanded="false">
                                        <li><a href="files.html?moduleID=2&pageID=43">其他安全文件</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li id="li_3">
                            <a href="tables.html"><i class="fa fa-android fa-fw"></i> 进度管理<span class="fa arrow"></span></a>
                            <!-- subItems -->
                            <!-- 模型管理 -->
                            <!-- 文档管理 -->
                            <!-- 视频管理 -->
                            <ul class="nav nav-second-level collapse">
                                <li>
                                    <!--<a href="models.html?moduleID=3&pageID=25">进度模型</a>-->
                                    <!--<a href="files.html?moduleID=2&pageID=39">安全相关其他文件</a>-->
                                    <a href="#">进度计划</a>
                                </li>
                                <li>
                                    <!--<a href="files.html?moduleID=3&pageID=26">进度计划</a>-->
                                    <a href="#">进度模型</a>
                                    <ul class="nav nav-third-level collapse" aria-expanded="false">
                                        <li><a href="models.html?moduleID=3&pageID=39">进度模型</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <!--<a href="videos.html?moduleID=3&pageID=27">计划进度</a>-->
                                    <a href="#">计划进度</a>
                                    <ul class="nav nav-third-level collapse" aria-expanded="false">
                                        <li><a href="videos.html?moduleID=3&pageID=27">计划进度</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <!--<a href="videos.html?moduleID=3&pageID=28">实时进度</a>-->
                                    <a href="#">实时进度</a>
                                    <ul class="nav nav-third-level collapse" aria-expanded="false">
                                        <li><a href="videos.html?moduleID=3&pageID=28">实时进度</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <!--<a href="videos.html?moduleID=3&pageID=28">实时进度</a>-->
                                    <a href="#">进度计划文件</a>
                                    <ul class="nav nav-third-level collapse" aria-expanded="false">
                                        <li><a href="files.html?moduleID=3&pageID=44">进度计划文件</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <!--<a href="#">接视频</a>-->
                                    <a href="#">接监控</a>
                                    <ul class="nav nav-third-level collapse" aria-expanded="false">
                                        <li><a href="#">接监控</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li id="li_4">
                            <a href="tables.html"><i class="fa fa-linux fa-fw"></i> 材料管理<span class="fa arrow"></span></a>
                            <!-- subItems -->
                            <!-- 模型管理 -->
                            <!-- 文档管理 -->
                            <!-- 视频管理 -->
                            <ul class="nav nav-second-level collapse">
                                <li>
                                    <a href="models.html?moduleID=4&pageID=12">模型管理</a>
                                </li>
                                <li>
                                    <a href="files.html?moduleID=4&pageID=10">文档管理</a>
                                </li>
                                <li>
                                    <a href="videos.html?moduleID=4&pageID=11">视频管理</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">进度信息</h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            进度信息                     
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">

                            <div id="gantt_here" style='width:100%; height:100%'></div>

                            <script type="text/javascript">
    function modSampleHeight() {
        var headHeight = 100;
        var sch = document.getElementById("gantt_here");
        sch.style.height = (parseInt(document.body.offsetHeight) - headHeight) + "px";
        var contbox = document.getElementById("contbox");
        contbox.style.width = (parseInt(document.body.offsetWidth) - 300) + "px";

        gantt.setSizes();
    }
    gantt.config.task_height = 16;
    gantt.config.row_height = 40;
    gantt.config.scale_height = 60;
    gantt.config.date_scale = "%d";
    gantt.config.autoscroll = true;
    gantt.config.buttons_left = ['dhx_save_btn'];
    gantt.config.buttons_right = ['dhx_cancel_btn', 'dhx_delete_btn'];
    gantt.config.xml_date = "%Y-%m-%d";
    gantt.config.task_date = "%Y-%m-%d";
    gantt.config.subscales = [
        { unit: "month", step: 1, date: "%Y年%m月" },
        { unit: "year", step: 1, date: "%Y年" }
    ];
    gantt.config.columns = [
  { name: "text", label: "任务名称", tree: false, width: '*' },
  { name: "add", align: "center", width: 100 },
    ];
    gantt.config.grid_width = 300;
    gantt.locale.labels.section_planstart = "计划开始日期";
    gantt.locale.labels.section_planend = "计划结束日期";
    gantt.locale.labels.section_actualstart = "实际开始日期";
    gantt.locale.labels.section_actualend = "实际结束日期";
    gantt.locale.labels.section_text = "标题";
    gantt.locale.labels.section_description = "详细描述";
    gantt.config.lightbox.sections = [
        { name: "text", type: "textarea", map_to: "text", height: 30 },
        { name: "description", type: "textarea", map_to: "description", height: 60 },
        { name: "planstart", type: "textarea", map_to: "plan_start_date", height: 30 },
        { name: "planend", type: "textarea", map_to: "plan_end_date", height: 30 },
        { name: "actualstart", type: "textarea", map_to: "actual_start_date", height: 30 },
        { name: "actualend", type: "textarea", map_to: "actual_end_date", height: 30 },
           //{ name: "plan", type: "time", map_to: { start_date: "plan_start_date", end_date: "plan_end_date" }, time_format: ["%Y", "%m", "%d"], year_range: [2000, 2100] },//出错
           //{ name: "actual", type: "time", map_to: { start_date: "actual_start_date", end_date: "actual_end_date" }, time_format: ["%Y", "%m", "%d"], year_range: [1988, 3000] },//出错

    ];

    gantt.addTaskLayer(function draw_planned(task) {
        if (task.actual_start_date != "" && task.actual_end_date != "") {
            var startdate = gantt.date.parseDate(task.actual_start_date, "xml_date");
            var enddate = gantt.date.parseDate(task.actual_end_date, "xml_date");
            var sizes = gantt.getTaskPosition(task, startdate, enddate);
            var el = document.createElement('div');
            el.className = 'baseline';
            el.style.left = sizes.left + 'px';
            el.style.width = sizes.width + 'px';
            el.style.top = sizes.top + gantt.config.task_height + 13 + 'px';
            return el;
        }
        return false;
    });
    gantt.templates.task_class = function (start, end, task) {
        if (task.actual_end_date) {
            var classes = ['has-baseline'];
            if (end.getTime() > (new Date(task.actual_end_date)).getTime()) {
                classes.push('overdue');
            }
            return classes.join(' ');
        }
        //if (task.planinterval)
        //    return "complex_gantt_bar";
    };
	//gantt.attachEvent("onTaskLoading", function (task) {
	//    //task.actual_start_date = gantt.date.parseDate(task.actual_start_date, "xml_date");
	//    //task.actual_end_date = gantt.date.parseDate(task.actual_end_date, "xml_date");
	//    //return true;
	//});
	gantt.init("gantt_here");
	gantt.load("http://www.shqhbim.com/bimAPI/Schedule/GetGantList", "json");
	var dp = new dataProcessor("http://www.shqhbim.com/bimAPI/Schedule/UpdateGanttData");//dhtmlxGantt保存变化，包括添加、更新、删除
	dp.init(gantt);
    //比大
    function tab1(date1, date2) {
        var oDate1 = new Date(date1);
        var oDate2 = new Date(date2);
        if (oDate1.getTime() > oDate2.getTime()) {
           return date1
        } else {
            return date2
        }
    }
    //比小
    function tab2(date1, date2) {
        var oDate1 = new Date(date1);
        var oDate2 = new Date(date2);
        if (oDate1.getTime() > oDate2.getTime()) {
            return date2
        } else {
            return date1
        }
    }

    function datedifference(d1,d2)
    {
        var date1 = new Date(d1);  //开始时间
        var date2 = new Date(d2);    //结束时间
        var date3 = date2.getTime() - date1.getTime()  //时间差的毫秒数


        //计算出相差天数
        var days = Math.floor(date3 / (24 * 3600 * 1000))
        return days;
    }

	//gantt.parse({
	//	"data":[
	//		{"id":1, "text":"测试标题",
	//		"start_date":"2013-04-01",
	//		"end_date": "2013-04-08",
	//		"plan_start_date": "2013-04-03",
	//		"plan_end_date": "2013-04-07",
	//		"actual_start_date": "2013-04-01",
	//		"actual_end_date": "2013-04-05",
    //            "description":"123",
	//		splitStart: 5,
	//		splitEnd: 5,
    //            pdate:2,
    //            //duration: "7", "open": true,
	//		}
	//	]
	//});
                            </script>
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-12 -->
            </div>
        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- jQuery -->
    <script src="../vendor/jquery/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="../vendor/metisMenu/metisMenu.min.js"></script>

    <!-- DataTables JavaScript -->
    <script src="../vendor/datatables/js/jquery.dataTables.min.js"></script>
    <script src="../vendor/datatables-plugins/dataTables.bootstrap.min.js"></script>
    <script src="../vendor/datatables-responsive/dataTables.responsive.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="../dist/js/sb-admin-2.js"></script>
    <script src="../dist/js/fileinput.js"></script>
    <script src="../dist/js/Utility/Utility.js"></script>
    <script src="../dist/js/Utility/QueryString.js"></script>
    <script src="../dist/js/Utility/bimPage.js"></script>

    <!-- Page-Level Demo Scripts - Tables - Use for reference -->
    <script>

        window.pageName = '';
        var currentPage = '';
        var arraySelected = new Array();
        var moduleName = '';

        $(document).ready(function () {

            intiPage('videoes');

            $('.page-header').html(currentPage + ' - 视频管理');

            loadData();

            $('#btnDelete').bind('click', function (event) {

                deleteFiles();
            });

            $('#btnUpload').bind('click', function (event) {

                console.log(' do upload video ' + moduleName);
                document.location.href = './uploadvideos.html?moduleID=' + jQuery.queryString('moduleID') + "&pageID=" + jQuery.queryString('pageID');
            });
        });

        function loadData() {
            $.ajax({
                url: bimConfig.APIDomainUrl + 'video/LoadVideoList',
                type: 'GET', //GET
                async: true,    //或false,是否异步
                data: {
                    moduleID: jQuery.queryString('moduleID'),
                    pageID: jQuery.queryString('pageID')
                },
                dataType: 'json',    //返回的数据格式：json/xml/html/script/jsonp/text
                beforeSend: function (xhr) {
                    console.log(xhr)
                    console.log('发送前')
                },
                success: function (data, textStatus, jqXHR) {
                    if (data) {

                        $('#dataTables-example').append(buildTableData(JSON.parse(data).Result));
                        $('#dataTables-example').DataTable({
                            "oLanguage": {
                                "sProcessing": "处理中...",
                                "sLengthMenu": "_MENU_ 记录/页",
                                "sZeroRecords": "没有匹配的记录",
                                "sInfo": "显示第 _START_ 至 _END_ 项记录，共 _TOTAL_ 项",
                                "sInfoEmpty": "显示第 0 至 0 项记录，共 0 项",
                                "sInfoFiltered": "(由 _MAX_ 项记录过滤)",
                                "sInfoPostFix": "",
                                "sSearch": "过滤:",
                                "sUrl": "",
                                "oPaginate": {
                                    "sFirst": "首页",
                                    "sPrevious": "上页",
                                    "sNext": "下页",
                                    "sLast": "末页"
                                }
                            },
                            responsive: true,
                            pageSize: 25
                        });
                    }
                },
                error: function (xhr, textStatus) {
                    console.log('错误')
                    console.log(xhr)
                    console.log(textStatus)
                },
                complete: function () {
                    console.log('结束')
                }
            });
        }

        function deleteFile(fileID) {
            $.ajax({
                url: bimConfig.APIDomainUrl + 'video/DeleteFile',
                type: 'POST', //GET
                async: true,    //或false,是否异步
                data: {
                    fileID: fileID
                },
                dataType: 'json',    //返回的数据格式：json/xml/html/script/jsonp/text
                beforeSend: function (xhr) {
                    console.log(xhr)
                    console.log('发送前')
                },
                success: function (data, textStatus, jqXHR) {
                    if (data) {

                        var obj = JSON.parse(data);
                        if(obj && obj.Result){
                            alert('操作成功');
                        }
                        else{
                            alert('操作失败');
                        }
                    }
                },
                error: function (xhr, textStatus) {
                    console.log('错误')
                    console.log(xhr)
                    console.log(textStatus)
                },
                complete: function () {
                    console.log('结束')
                }
            });
        }

        function buildTableData(data) {
            var html = '';

            $(data).each(function (index, element) {
                var domID = Guid.NewGuid().ToString();

                html += '<tr id="' + element.VideoID + '">';

                //td1
                html += '<td style="text-align: center;" >' + currentPage + ' - ' + decodeURIComponent(element.FileName) + '</td>';
                //td2

                html += '<td style="text-align:center;">';
                html += '<a class="center-block" data-Index="' + index + '" data-file="' + element.FileID + '" style="margin :0 auto; float:none;" class="tdCKB" onclick="playVideo(this)" >播放</a>';
                if (window.userInfo && window.userInfo.CanDelete) {
                    //html += '<td><input class="center-block" data-file="' + element.fileId + '" style="margin :0 auto; float:none;" type="checkbox" class="tdCKB" onclick="onTableCKBSelected(this)" ></td>';
                    html += '<a class="center-block" data-Index="' + index + '" data-file="' + element.VideoID + '" style="margin :0 auto; float:none;" class="tdCKB" onclick="deleteVideo(this)" >删除</a>';
                }
                else {
                    html += '<td></td>';
                }

    

                html += '</tr>';
            });

            return html;
        }

        function playVideo(dom) {
        
            var url = "playVideo.html?fileID=" + $(dom).data('file');
            window.open(url, "播放视频", "width=850,height=500,toolbar=no,scrollbars=no,menubar=no,screenX=100,screenY=100");
        }

        function deleteVideo(dom) {

            $.ajax({
                url: bimConfig.APIDomainUrl + 'video/DeleteVideo',
                type: 'POST', //GET
                async: true,    //或false,是否异步
                data: {
                    fileID: $(dom).data('file'),
                    moduleID: jQuery.queryString('moduleID')
                },
                dataType: 'json',    //返回的数据格式：json/xml/html/script/jsonp/text
                beforeSend: function (xhr) {
                    console.log(xhr)
                    console.log('发送前')
                },
                success: function (data, textStatus, jqXHR) {
                    if (true || data) {

                        alert('操作成功');

                        var tr = $('#' + $(dom).data('file'));
                        var table = $('#dataTables-example').DataTable();
                        table.row(tr).remove().draw();
                    }
                },
                error: function (xhr, textStatus) {
                    console.log('错误')
                    console.log(xhr)
                    console.log(textStatus)
                },
                complete: function () {
                    console.log('结束')
                }
            });
        }

        function onTableCKBSelected(dom) {

            if (dom.checked) {
                //add
                arraySelected.push($(dom).data('file'));
            }
            else {
                //remove
                for (var i = 0; i < arraySelected.length; i++) {
                    if ($(dom).data('file') == arraySelected[i]) {
                        arraySelected.splice(i, 1);
                    }
                }
            }

            console.log( $(dom).data('file') );
        }

        function deleteFiles() {
            if (arraySelected.length > 0) {
                console.log(' to do deleteFiles ');
                while (arraySelected.length > 0) {
                    var id = arraySelected.pop();

                    var tr = $('#' + id);
                    var table = $('#dataTables-example').DataTable();
                    table.row(tr).remove().draw();
                }
            }
            else {
                console.log(' noData to do deleteFiles ');
            }
        }

        function showEdit() {
            $('.tdCKB').show();
        }

    </script>

</body>

</html>
